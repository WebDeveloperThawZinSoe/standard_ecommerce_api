$(function(){$('.recommended-goods-buy .goods-select li').click(function(){$(this).addClass('active').siblings('li').removeClass('active');var type=$(this).attr('data-type');$('.recommended-goods-buy .item[data-type='+type+']').addClass('display').siblings('.item').removeClass('display');});$('.item-device li').click(function(){$(this).addClass('active').siblings('li').removeClass('active');var id=$(this).attr('data-device_id');$('.recommended-goods-buy .item.display .item-server ul[data-device_id='+id+']').addClass('active').siblings('ul').removeClass('active');orbAjaxList($(this).parents('.item'));goodsTitle();});$('.item-server li').click(function(){$(this).addClass('active').siblings('li').removeClass('active');goodsTitle();orbAjaxList($(this).parents('.item'));});goodsTitle();function goodsTitle(){var text=$('.recommended-goods-buy .item.display .item-server ul.active li.active span').text();$('.item-title p span').text(text);}
function orbAjaxList(that){var cate_id=0;var server_id=that.find('.item-server ul.active input').attr('data-id');if(that.find('.item-server ul.active li.active').length>0){server_id=that.find('.item-server ul.active li.active').attr('data-id');}
$.ajax({url:siteUrl+'/goods/goods_ajax',type:'get',dataType:'json',data:{template_type:'items',server_id:server_id,cate_id:cate_id},beforeSend:function(){that.find('.item-amount').hide();that.find('.spinner').show();},success:function(res){that.find('.spinner').hide();if(res.data.goods.length!=0){that.find('.item-amount').show();var goods=res.data.goods[0];that.find('.item-price .price').attr('lkr',goods.true_price);that.find('.item-num input').attr('data-num',goods.min_num);var max_num=Math.ceil(2000/parseFloat(goods.true_price));var attributes={min:goods.min_num,max:max_num};that.find('.item-num input').val(goods.min_num);that.find('.item-amount').attr('data-id',goods.goods_no);that.find('.item-amount').attr('data-src',goods.images);that.find('.item-slider input').attr(attributes).rangeslider('update',true);that.find('input.range-input').val(goods.min_num).change();if(goods.item_price&&goods.item_price!=''){if(goods.discount>0){that.find('.old-price .price').attr('lkr',goods.item_price);that.find(' .old-price').addClass('display');}}else{that.find('.old-price').removeClass('display');}
priceCalc();}else{that.find('.item-amount').hide();}}});}
var $document=$(document);var $inputRange=$('.range-input-e');var $inputRangc=$('.range-input-c');var $inputRangd=$('.range-input-d');function valueOutput(element){var value=element.value;$('output').html=value;$('.exalted-orb .item-num input').val(value);}
function valueOutputc(element){var value=element.value;$('output').html=value;$('.chaos-orb .item-num input').val(value);}
function valueOutputd(element){var value=element.value;$('output').html=value;$('.divine-orb .item-num input').val(value);}
for(var i=$inputRange.length-1;i>=0;i--){valueOutput($inputRange[i]);};for(var i=$inputRangc.length-1;i>=0;i--){valueOutputc($inputRangc[i]);};for(var i=$inputRangd.length-1;i>=0;i--){valueOutputd($inputRangd[i]);};$document.on('input','.range-input-e',function(e){valueOutput(e.target);priceCalc();});$document.on('input','.range-input-c',function(e){valueOutputc(e.target);priceCalc();});$document.on('input','.range-input-d',function(e){valueOutputd(e.target);priceCalc();});$inputRange.rangeslider({polyfill:false});$inputRangc.rangeslider({polyfill:false});$inputRangd.rangeslider({polyfill:false});function priceCalc(){var price=$('.recommended-goods-buy .item.display .item-price .price');var rate=$('.header .lang-currency>p.curr-name').attr('data-rate');price.each(function(){var lkr=$(this).attr('lkr');var num=$(this).parents('.item').find('.item-num input').val();var newLkr=num*lkr;var price=(newLkr*rate).toFixed(2);$(this).find('i').text(price);});}
$('.recommended-goods-buy .item .item-num').on('blur','input',function(){var min=$(this).attr('data-num');var max=$(this).parents('.item').find('input.range-input').attr('max');console.log(max);if($(this).val()==''||$(this).val()==0){$(this).val(min);}
if(parseFloat($(this).val())>parseFloat(max)){$(this).val(max);}
$(this).parents('.item').find('input.range-input').val($(this).val()).change();});$('.recommended-goods-buy .item .item-num').on('click','.sub',function(){changeRange('sub');});$('.recommended-goods-buy .item .item-num').on('click','.add',function(){changeRange('add');});function changeRange(type){var value=$('.recommended-goods-buy .item.display .item-num input').val();var step=$('.recommended-goods-buy .item.display .item-num input').attr('data-num');var max=$('.recommended-goods-buy .item.display input.range-input').attr('max');if(type=='add'){if(parseFloat($('.recommended-goods-buy .item.display .item-num input').val())>=parseFloat(max)){}else{$('.recommended-goods-buy .item.display input.range-input').val(parseFloat(value)+parseFloat(step)).change();}}else{if(parseFloat($('.recommended-goods-buy .item.display .item-num input').val())<=step){}else{$('.recommended-goods-buy .item.display input.range-input').val(parseFloat(value)-parseFloat(step)).change();}}}
$('.recommended-goods-buy .item button').click(function(){var that=$(this);addCart(that);let affiliate='';if($('#isAffiliate').length>0&&$('#isAffiliate').val()!=''){affiliate='?id='+$('#isAffiliate').val();}
else{affiliate=''}
window.location.href=siteUrl+'/cart'+affiliate;});function addCart(that){var device_type=$('.recommended-goods-buy .item.display .item-server ul.active li.active').attr('value')
if(localStorage['cart']&&localStorage['cart']!=''){if(device_type!=localStorage['cate_type']){localStorage.removeItem('cart')}}
$.cookie('game_sku','poe898');var shopCart;if(localStorage['cart']&&localStorage['cart']!=''){datas=localStorage['cart'];shopCart=JSON.parse(decodeURIComponent(window.atob(localStorage.getItem("cart"))));}else{shopCart={};shopCart.list=[];}
var goods={};var type=0;for(var i=0;i<shopCart.list.length;i++){if(shopCart.list[i].goods_no==that.parents('.item').find('.item-amount').attr('data-id')){type++;if(parseFloat(shopCart.list[i].num)+parseFloat(that.parents('.item').find('.item-num input').val())<that.parents('.item').find('.item-slider .range-input').attr('max')){shopCart.list[i].num=parseFloat(shopCart.list[i].num)+parseFloat(that.parents('.item').find('.item-num input').val());}else{shopCart.list[i].num=that.parents('.item').find('.item-slider .range-input').attr('max');}
break;}}
if(type==0){if(that.parents('.item').find('.item-server ul.active li.active span').text().indexOf('XBOX')!=-1){goods.device_type='xbox';}else if(that.parents('.item').find('.item-server ul.active li.active span').text().indexOf('PS4')!=-1){goods.device_type='ps';}else{goods.device_type='pc';}
goods.goods_no=that.parents('.item').find('.item-amount').attr('data-id');goods.num=that.parents('.item').find('.item-num input').val();goods.step=that.parents('.item').find('.item-num input').attr('data-num');goods.max_num=that.parents('.item').find('.item-slider .range-input').attr('max');goods.title=that.parents('.item').find('.item-title p').text();goods.img=that.parents('.item').find('.item-amount').attr('data-src');goods.price=that.parents('.item').find('.item-price .news-price .price').attr('lkr');goods.game_sku='poe898';if(parseFloat(goods.num)==0||goods.num==''){return false;}
shopCart.list.unshift(goods);}
localStorage['cate_type']=device_type;localStorage['cart']=window.btoa(window.encodeURIComponent(JSON.stringify(shopCart)));}});